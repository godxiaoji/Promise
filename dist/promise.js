!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.EventEmitter=factory()}("undefined"!=typeof self?self:this,function(){"use strict";function isFunction(obj){return"function"==typeof obj}var Promise=function(resolver){var self=this;this._status=0,this._value,this._reason,this._resolves=[],this._rejects=[];resolver(function(value){self._status=1,self._value=value;for(var i=0;i<self._resolves.length;i++)self._resolves[i](self._value)},function(reason){self._status=2,self._reason=reason;for(var i=0;i<self._rejects.length;i++)self._rejects[i](self._reason)})};return Promise.resolve=function(value){return new Promise(function(resolve,reject){resolve(value)})},Promise.reject=function(reason){return new Promise(function(resolve,reject){reject(reason)})},Promise.all=function(promises){return new Promise(function(resolve,reject){var p,values=[],i=0,j=0,len=promises.length;function then(p,i){p.then(function(value){values[i]=value,++j>=len&&resolve(values)},function(reason){reject(reason)})}for(;i<len;i++)(p=promises[i])instanceof Promise?then(p,i):(values[i]=p,++j>=len&&resolve(values))})},Promise.race=function(promises){return new Promise(function(resolve,reject){for(var p,i=0,sign=0,len=promises.length;i<len;i++)(p=promises[i])instanceof Promise?p.then(function(value){sign||(sign=1,resolve(value))},function(reason){sign||(sign=1,reject(reason))}):sign||(sign=1,resolve(p))})},Promise.prototype={then:function(onFulfilled,onRejected){var self=this;return new Promise(function(resolve,reject){function callback(value){var obj,ret=value;if(isFunction(onFulfilled))try{ret=onFulfilled(value)}catch(e){return void reject(e)}(obj=ret)&&isFunction(obj.then)?ret.then(function(value){resolve(value)},function(reason){reject(reason)}):resolve(ret)}function errback(reason){var ret=isFunction(onRejected)?onRejected(reason):reason;reject(ret)}0===self._status?(self._resolves.push(callback),self._rejects.push(errback)):1===self._status?callback(self._value):2===self._status&&errback(self._reason)})},catch:function(fn){return this.then(null,fn)}},Promise});